<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Deploy WebJobs from Team Services | Brave Geek</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is gonna be easySo you just finished writing your awesome new WebJob that’s gonna save you hours of work.You just need to get it up to Azure, and Mission Accomplished.
Simple, right click on the">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy WebJobs from Team Services">
<meta property="og:url" content="http:/bravegeek.github.io/2016/12/03/Deploy-WebJobs-from-Team-Services/index.html">
<meta property="og:site_name" content="Brave Geek">
<meta property="og:description" content="This is gonna be easySo you just finished writing your awesome new WebJob that’s gonna save you hours of work.You just need to get it up to Azure, and Mission Accomplished.
Simple, right click on the">
<meta property="og:image" content="http:/bravegeek.github.io/content/images/2016/vsts.webjob.png">
<meta property="og:image" content="http:/bravegeek.github.io/content/images/2016/build.def.webjob.png">
<meta property="og:image" content="http:/bravegeek.github.io/content/images/2016/release.def.webjob.png">
<meta property="og:image" content="http:/bravegeek.github.io/content/images/2016/release.def.webjob.folder.select.png">
<meta property="og:image" content="http:/bravegeek.github.io/content/images/2016/WebJobs.azure.png">
<meta property="og:updated_time" content="2016-12-03T21:35:50.692Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Deploy WebJobs from Team Services">
<meta name="twitter:description" content="This is gonna be easySo you just finished writing your awesome new WebJob that’s gonna save you hours of work.You just need to get it up to Azure, and Mission Accomplished.
Simple, right click on the">
<meta name="twitter:image" content="http:/bravegeek.github.io/content/images/2016/vsts.webjob.png">
<meta name="twitter:creator" content="@gregread">
  
    <link rel="alternate" href="/atom.xml" title="Brave Geek" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Brave Geek</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">courageously breaking technology</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/gregread" title="tiwtter"></a>
        
        
          <a id="nav-linkedin-link" class="nav-icon" href="https://www.linkedin.com/in/gregoryread" title="linked_in"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/bravegeek" title="github"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http:/bravegeek.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Deploy-WebJobs-from-Team-Services" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/03/Deploy-WebJobs-from-Team-Services/" class="article-date">
  <time datetime="2016-12-03T13:59:04.000Z" itemprop="datePublished">2016-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Deploy WebJobs from Team Services
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/content/images/2016/vsts.webjob.png" alt=""></p>
<h2 id="This-is-gonna-be-easy"><a href="#This-is-gonna-be-easy" class="headerlink" title="This is gonna be easy"></a>This is gonna be easy</h2><p>So you just finished writing your awesome new WebJob that’s gonna save you hours of work.<br>You just need to get it up to Azure, and Mission Accomplished.</p>
<p>Simple, right click on the Project (in Visual Studio) and select <code>Publish as Azure WebJob</code>, follow the wizard.</p>
<p>Check Azure, yup it’s there.</p>
<h2 id="Wait-a-sec-not-so-fast"><a href="#Wait-a-sec-not-so-fast" class="headerlink" title="Wait a sec, not so fast"></a>Wait a sec, not so fast</h2><p>Then your teammate reminds you that it needs to automatically deploy from your CI. (Thanks Jeremy, really.)<br>Piece of cake, you’re using Visual Studio Team Services, just add another Release task in your Release Definition.</p>
<p>And that’s where the wheels fall off your little red wagon. (I don’t hate wagons, just Jeremy’s stupid red one.)</p>
<p>It turns out that Team Services doesn’t have a canned task for deploying WebJobs.</p>
<h2 id="Hey-what’s-going-on"><a href="#Hey-what’s-going-on" class="headerlink" title="Hey, what’s going on"></a>Hey, what’s going on</h2><p>Let’s understand how WebJobs work in Azure.</p>
<ol>
<li>You need an App Service for your WebJob to live under</li>
<li>The WebJob needs to be deployed to a specific directory</li>
</ol>
<p>Number 1 is pretty easy, you probably already have an App Service in Azure.<br>(I’m actually running an ASP.net Core app, and deploying a .net 4.52 WebJob.)</p>
<p>Number 2 isn’t so obvious, so you might want to <a href="https://github.com/projectkudu/kudu/wiki/Web-Jobs" target="_blank" rel="external">read more about WebJobs</a></p>
<p><em>TLDR</em><br>To deploy a triggered job copy your binaries to: d:\home\site\wwwroot\app_data\jobs\triggered\{job name}<br>To deploy a continuous job copy your binaries to: d:\home\site\wwwroot\app_data\jobs\continuous\{job name}</p>
<p><strong>The trick is getting your WebJob binaries into the correct folder on Azure.</strong></p>
<p>Let me say that again:<br><strong>The trick is getting your WebJob binaries into the correct folder on Azure.</strong></p>
<h2 id="The-Trick"><a href="#The-Trick" class="headerlink" title="The Trick"></a>The Trick</h2><p>There are two key steps to getting this trick to work:</p>
<ol>
<li>Add a <code>Copy Files</code> step to your Build definition.</li>
<li>Add an <code>Azure App Service Deploy</code> task to your Release definition.</li>
</ol>
<h3 id="Copy-Files-Build-definition"><a href="#Copy-Files-Build-definition" class="headerlink" title="Copy Files (Build definition)"></a>Copy Files (Build definition)</h3><p>The thing to understand here is that when files are copied to Azure, they retain their original folder structure.<br>We’re going to use that fact to setup the correct folder structure after we build.</p>
<p>(I’ve named your WebJob <code>WebJobTest</code> and it’s continuous, you’re welcome Jeremy.)</p>
<ul>
<li>In your Build definition, add a <code>Copy Files</code> step after the build step.</li>
<li>Set these properties<ul>
<li>Source Folder: src/WebJobTest/bin/$(BuildConfiguration)/</li>
<li>Contents: **</li>
<li>Target Folder: $(build.artifactstagingdirectory)\WebJobTest\App_Data\jobs\continuous\WebJobTest</li>
</ul>
</li>
</ul>
<p><img src="/content/images/2016/build.def.webjob.png" alt=""></p>
<h3 id="Azure-App-Service-Deploy-Release-definition"><a href="#Azure-App-Service-Deploy-Release-definition" class="headerlink" title="Azure App Service Deploy (Release definition)"></a>Azure App Service Deploy (Release definition)</h3><p>Now that the WebJob files are in the correct folder structure, we can just deploy that folder to Azure.</p>
<ul>
<li>In your Release definition, add an <code>Azure App Service Deploy</code> task.</li>
</ul>
<p><img src="/content/images/2016/release.def.webjob.png" alt=""></p>
<ul>
<li>Set <code>Package or Folder</code> to $(System.DefaultWorkingDirectory)//{YourBuildDefinition}/drop/WebJobTest </li>
</ul>
<p><img src="/content/images/2016/release.def.webjob.folder.select.png" alt=""></p>
<p>That will copy everything below <code>WebJobTest</code>, starting with <code>App_Data</code>, which is the folder structure we need for WebJobs.</p>
<h2 id="That’s-all-folks"><a href="#That’s-all-folks" class="headerlink" title="That’s all folks"></a>That’s all folks</h2><p>Now your WebJobs are deploying automatically and Jeremy is happy about his red wagon.<br>(That job is totally not made up or photo-shopped in any way.)</p>
<p>Since you can have multiple WebJobs under an App Service, just lather, rinse, repeat to add more. </p>
<p><img src="/content/images/2016/WebJobs.azure.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http:/bravegeek.github.io/2016/12/03/Deploy-WebJobs-from-Team-Services/" data-id="ciw9an0zh0000agpii2rwk0ve" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Team-Services/">Team Services</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VSO/">VSO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebJobs/">WebJobs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Entity Framework 6 and Sybase SQL Anywhere</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entity-Framework/">Entity Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance-Tuning/">Performance Tuning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sybase/">Sybase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Team-Services/">Team Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSO/">VSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebJobs/">WebJobs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Entity-Framework/" style="font-size: 20px;">Entity Framework</a> <a href="/tags/Performance-Tuning/" style="font-size: 10px;">Performance Tuning</a> <a href="/tags/Sybase/" style="font-size: 10px;">Sybase</a> <a href="/tags/Team-Services/" style="font-size: 10px;">Team Services</a> <a href="/tags/VSO/" style="font-size: 10px;">VSO</a> <a href="/tags/WebJobs/" style="font-size: 10px;">WebJobs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/03/Deploy-WebJobs-from-Team-Services/">Deploy WebJobs from Team Services</a>
          </li>
        
          <li>
            <a href="/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/">Entity Framework 6 and Sybase SQL Anywhere</a>
          </li>
        
          <li>
            <a href="/2015/05/20/Troubleshooting-Entity-Framework-performance-problems/">Troubleshooting Entity Framework performance problems</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Greg Read<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>