<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Brave Geek</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Brave Geek">
<meta property="og:url" content="http:/bravegeek.github.io/index.html">
<meta property="og:site_name" content="Brave Geek">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brave Geek">
<meta name="twitter:creator" content="@bravegeek">
  
    <link rel="alternate" href="/atom.xml" title="Brave Geek" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Brave Geek</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">courageously breaking technology</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http:/bravegeek.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Entity-Framework-6-and-Sybase-SQL-Anywhere" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/" class="article-date">
  <time datetime="2016-07-14T03:45:02.000Z" itemprop="datePublished">2016-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/">Entity Framework 6 and Sybase SQL Anywhere</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/content/images/2016/ef6.sybase.png" alt=""></p>
<h2 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h2><p>Getting Sybase SQL Anywhere 16 (SA16) to work with Entity Framework 6 (EF6) can be a bit of a challenge. What made our situation particularly challenging was that we had older versions of Entity Framework (EF4) that needed to work with SA16.</p>
<p>Sybase documentation instructs you to install the latest version of Sybase and then run the special .exe for EF6. Unfortunately, this leaves you with SA16 drivers that ONLY work with EF6. Any other code that needs to use an older version of EF won’t work correctly.</p>
<h2 id="The-Fix"><a href="#The-Fix" class="headerlink" title="The Fix"></a>The Fix</h2><p>It turns out there is a way to have both! Some simple config file changes will accomplish this.</p>
<p>You’ll need to modify three sections: </p>
<ol>
<li>connectionStrings</li>
<li>system.data</li>
<li>entityFramework</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"YourSybaseConnection"</span> <span class="attr">connectionString</span>=<span class="string">"Host=your_hosting_server;ServerName=your_Sybase_DB_server_instance;DatabaseName=your_db_name;uid=db_user_id;pwd=db_pwd"</span> <span class="attr">providerName</span>=<span class="string">"iAnywhere.Data.SQLAnywhere"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">system.data</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DbProviderFactories</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">clear</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"SQL Anywhere 16 Data Provider"</span> <span class="attr">invariant</span>=<span class="string">"iAnywhere.Data.SQLAnywhere"</span> <span class="attr">description</span>=<span class="string">".Net Framework Data Provider for SQL Anywhere 16"</span> <span class="attr">type</span>=<span class="string">"iAnywhere.Data.SQLAnywhere.SAFactory, iAnywhere.Data.SQLAnywhere.EF6, Version=16.0.0.20434, Culture=neutral, PublicKeyToken=f222fc4333e0d400"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">DbProviderFactories</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">system.data</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">entityFramework</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">defaultConnectionFactory</span> <span class="attr">type</span>=<span class="string">"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">parameters</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">value</span>=<span class="string">"mssqllocaldb"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">parameters</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">defaultConnectionFactory</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">providers</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">provider</span> <span class="attr">invariantName</span>=<span class="string">"System.Data.SqlClient"</span> <span class="attr">type</span>=<span class="string">"System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">provider</span> <span class="attr">invariantName</span>=<span class="string">"iAnywhere.Data.SQLAnywhere"</span> <span class="attr">type</span>=<span class="string">"iAnywhere.Data.SQLAnywhere.SAProviderServices, iAnywhere.Data.SQLAnywhere.EF6, Version=16.0.0.20434, Culture=neutral, PublicKeyToken=f222fc4333e0d400"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">entityFramework</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Now your code that uses the older EF should run side-by-side with the new EF6 code.</p>
<h3 id="Noteworthy"><a href="#Noteworthy" class="headerlink" title="Noteworthy"></a>Noteworthy</h3><p>The Sybase connection string is definitely different than a MS SQL connection string.<br>If you follow my example, you won’t need to setup an ODBC DSN; it will simply connect.</p>
<p>Make sure you’re running a newer version of Sybase SA16, some older versions don’t have the .dll’s for EF6.</p>
<p>Helpful links:<br><a href="http://sqlanywhere-forum.sap.com/questions/22161/entity-framework-6-provider" target="_blank" rel="external">How to add Sybase EF6 provider</a><br><a href="http://dcx.sybase.com/index.html#sa160/en/dbprogramming/deploying-adonet-deploy.html" target="_blank" rel="external">Sybase .Net client deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http:/bravegeek.github.io/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/" data-id="ciw1lq3hl0000gcpimyoh6yc0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Entity-Framework/">Entity Framework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sybase/">Sybase</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Troubleshooting-Entity-Framework-performance-problems" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/20/Troubleshooting-Entity-Framework-performance-problems/" class="article-date">
  <time datetime="2015-05-21T03:14:04.000Z" itemprop="datePublished">2015-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/20/Troubleshooting-Entity-Framework-performance-problems/">Troubleshooting Entity Framework performance problems</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/content/images/2015/ef.jpg" alt=""></p>
<h2 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h2><p>Some of our data services were running slower than we liked, a lot slower.<br>Since our Web Api services are using Linq to Entities behind the scenes, I suspected the SQL being generated by EF might not be optimized.<br>I fired up SQL Profiler and my suspicions were confirmed.</p>
<p>There were two significant problems with the parameters EF was generating:</p>
<ol>
<li>varchar types were being cast to nvarchar</li>
<li>smallint types were being cast to int</li>
</ol>
<h2 id="Nvarchar-parameters-in-string-queries"><a href="#Nvarchar-parameters-in-string-queries" class="headerlink" title="Nvarchar parameters in string queries"></a>Nvarchar parameters in string queries</h2><p>With the first problem I saw this in my Where clause when I was checking out queries in Profiler:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@MyVarcharParm = N'myStringValue'</div></pre></td></tr></table></figure>
<p>Brian Sullivan has a fantastic <a href="http://www.sullivansoftdev.com/blog/2013/04/02/entity-framework-code-first-performance-issue-with-string-queries/" target="_blank" rel="external">article</a> explaining this and his <a href="http://stackoverflow.com/questions/15767803/entity-framework-query-slow-but-same-sql-in-sqlquery-is-fast" target="_blank" rel="external">solution</a> is great, decorate the property in your model.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[Column(TypeName = <span class="string">"varchar"</span>)]</div><div class="line"><span class="keyword">public</span> <span class="keyword">string</span> MyStringProperty &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div></pre></td></tr></table></figure>
<p>This reduced my query times by an order of magnitude!</p>
<h2 id="Smallint-cast-as-int"><a href="#Smallint-cast-as-int" class="headerlink" title="Smallint cast as int"></a>Smallint cast as int</h2><p>The second problem also lies in the Where clause:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CAST ([Extent1].[MySmallintProperty] AS int) = @p__linq__0</div></pre></td></tr></table></figure>
<p>StackOverflow came to the <a href="http://stackoverflow.com/questions/22149456/entity-framework-ridiculous-query-casting-smallint-to-int-for-comparison" target="_blank" rel="external">rescue</a>. I’ll let them give a detailed explanation…</p>
<p>My Linq statement looked like:<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.Where(x =&gt; x.MySmallintProperty == myShortValue)</div></pre></td></tr></table></figure></p>
<p>so I changed it to:<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.Where(x =&gt; x.MySmallintProperty.Equals(myShortValue))</div></pre></td></tr></table></figure></p>
<p>This also reduced my query times.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http:/bravegeek.github.io/2015/05/20/Troubleshooting-Entity-Framework-performance-problems/" data-id="ciw1lq3hs0001gcpi0n8nz9z5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Entity-Framework/">Entity Framework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance-Tuning/">Performance Tuning</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entity-Framework/">Entity Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance-Tuning/">Performance Tuning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sybase/">Sybase</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Entity-Framework/" style="font-size: 20px;">Entity Framework</a> <a href="/tags/Performance-Tuning/" style="font-size: 10px;">Performance Tuning</a> <a href="/tags/Sybase/" style="font-size: 10px;">Sybase</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/13/Entity-Framework-6-and-Sybase-SQL-Anywhere/">Entity Framework 6 and Sybase SQL Anywhere</a>
          </li>
        
          <li>
            <a href="/2015/05/20/Troubleshooting-Entity-Framework-performance-problems/">Troubleshooting Entity Framework performance problems</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Greg Read<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>